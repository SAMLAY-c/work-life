**核心目的：**

防止老师在“群发助手”模式下误用动态参数（如#学生姓名），导致系统降级为单条发送，从而引发**队列堵塞**和**额度浪费**。

**两个主要功能点：**

1. **发送拦截校验**：【已完成】

- 在“群发助手”**模式下，若文案包含“#”字符，点击提交时**触发弹窗警告。
- 用户需二次确认：要么返回修改，要么忽略变量（作为普通文本）继续发送。

2. **参数样式高亮（可视）**：

- 在编辑文案时，动态参数（如#学生姓名）自动显示为**特殊样式**（如蓝色/加粗），以便与普通文本直观区分。

- 涉及系统：锦书、恒行、爱学
- 页面路径：沟通 / 课程/练习/企微工具/作业点评；

# 0. 版本记录

|   |   |   |   |
|---|---|---|---|
|版本号|修订日期|修订人|修订详情|
|v1.0|20251125|林承列|创建文档：群发助手校验与参数样式优化|

# 1. 需求来源

中学、小学

# 2. 背景

**背景：**

1. 目前在“创建任务”时，老师若选择“群发助手”作为发送方式，系统虽不支持动态参数（如#学生姓名），但未做强制拦截。
    
    1. **系统风险**：部分老师习惯直接复制包含动态参数的文案【#学生姓名】。当“群发助手”模式下包含动态参数时，系统无法进行广播式群发，而是强制转为单条排队发送（例如选100人需排队发100次）。这导致：
        
        - 群发助手额度被迅速耗尽。
            
        - 发送队列严重堵塞，甚至排队到第二天，严重影响时效性。
            
2. **体验问题**：目前的文案编辑框中，动态参数（# 学生姓名等）与普通文本无样式区分，老师难以直观辨别。
    

# 3. 方案概述

**略**

# 4. 项目风险

无

# 5. 功能描述

|   |   |   |
|---|---|---|
|位置|**规则说明**|**图示**|
|~~涉及系统：锦书、恒行~~<br><br>~~页面路径：沟通 / 课程/练习 页面/企微工具；~~<br><br>~~唤起“发企微”弹窗~~<br><br>~~改动点与生效范围：~~<br><br>~~发送限制校验：仅涉及 “群发助手” 模式。~~|### ~~群发助手模式下的参数校验~~<br><br>- ~~**触发时机**~~~~：老师在“创建任务”页面点击【确定】时。~~<br>    <br>- ~~**【新增】校验逻辑**~~~~：~~<br>    <br>    - ~~**前置条件**~~~~：【发送方式】选择了“群发助手”。~~<br>        <br>    - ~~**触发条件**~~~~：【发送内容】中检测到包含“#”字符（疑似动态参数）。~~<br>        <br>- ~~**执行动作**~~~~：~~<br>    <br>    - ~~若满足上述条件，系统~~~~**中断当前提交**~~~~，弹出~~~~**二次确认弹窗**~~~~。~~<br>        <br>    - ~~若用户点击弹窗内的【继续发送】，则忽略风险提交任务，前端将“#”作为普通文本， 不进行动态变量替换；若点击【返回修改】，则关闭弹窗停留在当前页。~~<br>        <br>- ~~**弹窗文案**~~~~：~~<br>    <br>    - ~~系统检测到内容中包含“#”字符。~~ ~~群发助手不支持自动替换动态变量（如 #学生姓名）。若“#”仅为普通文本符号，您可以继续发送；若是动态变量，请返回修改发送方式。~~ ~~**按钮：**~~ ~~[返回修改]~~ ~~**[继续发送]**~~|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=NzUzNjA1NDc1YTE4NDA4ZTMyYmQ0YTRjYjVlOTNkYWFfWEs5aEFUZEgyb3hoaVd2bXhxeVhlNTlHNkp6a1JsU1RfVG9rZW46U1M5RmIwNmdpb1lqMWd4OFJRRWM5NHNRbm1lXzE3NjQ0OTY2MDQ6MTc2NDUwMDIwNF9WNA)|
|涉及系统：<br><br>锦书、恒行、爱学<br><br>页面路径：沟通 / 课程/练习/企微工具/作业点评；<br><br>唤起“发企微”弹窗<br><br>改动点与生效范围：<br><br>参数样式优化：涉及 “对话框发送” 和 “群发助手” 两种模式。|### 动态参数样式高亮<br><br>- **所在模块**：创建任务页面的“文案”编辑区域，重建富文本编辑器。<br>    <br>- **功能逻辑**：<br>    <br>    - 当老师插入动态参数（如点击插入“学生姓名”），或直接粘贴包含系统识别的参数代码时。<br>        <br>    - 前端对该段文本应用特殊样式，使其与普通正文区分。<br>        <br>- **样式要求**：<br>    <br>    - 字体颜色变更为蓝色，或增加加粗/斜体效果（参考新强调研结果）。@王新强<br>        <br>    - 目的：让老师一眼识别出哪些是会被替换的变量，哪些是固定文本。||

# 6. 数据需求

无

# 7. 运营计划

上线后需同步给业务侧（中学/小学辅导老师），告知“群发助手”不再允许夹带变量，引导规范操作。

  

# 8. 附录

无