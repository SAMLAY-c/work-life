# **1. 项目背景与目标**

## **1.1 背景**

辅导老师为了说服家长以“不知道孩子是否想要报名”的原因，普遍采用在直播课中手动截图或录屏的方式来记录学生的聊天内容。这种方式存在以下痛点：

- **效率低下：** 耗费老师大量精力，干扰直播间运营。
    
- **信息遗漏：** 快速刷屏时，截图极易遗漏关键信息，数据不完整。
    
- **难以追溯：** 截图是非结构化数据，不便于找到对应的家长沟通和家长的沟通。
    

# **2. 目标用户**

- **核心用户：** 0元+198业务线的直播课和小灶课“小班会”。（0元业务线有直播间聊天记录导出功能，198业务线没有）
    
- 系统根据 `辅导老师` 的直播间id，`组ID` ，和 时段`ID`精准圈定当天负责的课节，并以此为唯一依据，支持导出对应课节的直播间发言记录。
    
- 在回访生成后（半小时）
    

# 3. 功能模块一：“转化页面”聊天记录导出

## 3.1 功能概述

- **交互界面：**“转化”页面新增“导出发言”按钮；
    
- 点击“导出记录”按钮，弹出弹窗倒序显示
    
    - 复选框
        
    - 上课日期（如：2025-09-04）
        
    - 时段课节名称如“18.【语文】欲扬先抑神转折”（超过10个字符，包括标点，显示省略号”...“）
        
    - 提示
        
- 选择点击日期旁边的复选框，显示打勾状态，点击“确认导出”按钮，下载所选课节的聊天记录。
    
- （限制：最多同时选择4个课节下载）
    

![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=MmM5OWIyMTdmYTRjYmJjZjc3ZWY4Nzc1NjE3ZDk0MjJfY0VEdWNMYk5wNGJrTWJPVlFZQUNEWGlvSzQwUk1NSVNfVG9rZW46Qk9iVmJ5dDZHb0RBTVl4dlRnVGNlakl1bkdiXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)

## **3.2 交互状态与逻辑规则**

### **3.2.1 状态说明**

**复选框状态（边框，填充）**

可用：边框状态**黑色**，无填充；点击后显示√

不可用（点击没反应）：边框状态**灰色**，无填充

生成失败：边框状态**黑色，红色填充**

**日期：**

**显示出来全程黑色**

**时段课节名称：显示出来后全程黑色**

**提示文案：显示出来后全程黑色，在时段课节名称下面**

### 3.2.2 场景汇总

|   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|
|状态/场景|**复选框状态**|日期|时段课节名称|提示文案|交互说明 / 用户操作|示例|
|~~**1. 上课之前**~~|~~不显示~~|~~不显示~~|~~不显示~~|~~/~~|~~**系统逻辑：**~~ ~~此记录行在开课时间下课前，不在列表中显示。~~|~~/~~|
|~~**2. 课进行中**~~|~~不可用~~|~~不显示~~|~~不显示~~|~~/~~|~~**系统逻辑：**~~ ~~课程开始后，记录行出现，但为保证数据完整性，复选框置灰不可操作。~~|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=NjRhM2IwZDdlZTcwN2EwYmE0ZmQ0NmY2OWQ4ZWJmNjFfdkpUM0tkZEhMcTgxaWFmWmVYWjlNNWh4WDUxYkViYVJfVG9rZW46Sm1aaWI0d09Db0FVd1Z4enFnTGNud3VKbmlkXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|**`3. 课结束，点击按钮`**|`不可用`|`黑色`|`黑色`|`生成中`|1. **触发条件**：课程结束后（可能需要等待回放数据生成，大约课后半小时），辅导老师在后台页面可以看到可操作的按钮。<br>    <br>2. 最多勾选4个课节进行下载<br>    <br>3. **用户操作**：辅导老师找到对应的课节，点击复选框，<br>    <br>4. **系统处理**：系统接收到请求后，开始**异步**处理生成聊天记录文件。此时前端界面会显示“生成中”的状态，并且按钮会被锁定，防止用户重复点击。|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=NTk3N2Y4ZmMzNzA1MWFlNzMzM2JmYjU1NzEyNjM0ZTJfY3puSGwweWc3Tmd1bzFRRkgxUkxlY0FzZlo0eWxrTWxfVG9rZW46U0oyb2IwOEg5b296Z3l4VjRsdWNtd0dDbm11XzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|**4. 生成成功**|可用|黑色|黑色|生成成功|**完成与下载**：当文件生成成功后，界面状态会更新为“可下载”或“查看”，辅导老师此时便可以点击下载生成的聊天记录表格。<br><br>**用户操作：** 点击”确认导出“，直接触发下载对应的Excel文件。<br><br>（限制：最多选择4个课节）|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=MDU4MzhiZWZmZjlmZjgwMTllODZiYjE5ODlkOGVmNDVfTHphazlOc0dyeHBUbnVmUmpQQlpLWXQ4dGY3TnN1R0hfVG9rZW46RWJYZmJNeWhsb3JIdFd4amRrSmN0cGxybmJiXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**5. 生成失败**~~|~~生成失败~~|~~黑色~~|~~黑色~~|~~生成失败，请重试~~|~~**系统逻辑：**~~ ~~后台数据处理失败。~~<br><br>~~**用户操作：**~~ ~~提示用户可以点击红色复选框重试。~~<br><br>~~用户点击红色复选框后，状态返回到~~ ~~**第3步 (课刚结束)**~~ ~~的“生成中”状态，系统重新处理数据。~~|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=NzQ4ZGM4NTU4M2JhYmJjZjRhMDNhMTRjZTdkZDk5ZDlfb0EyaVFSSE95Q3o4enRDY2UxdkFrOW4yOFl6bzU0MTFfVG9rZW46Sm16amJZV2hEb2dMVTV4QmVoYmNDMXZlbnlkXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**6. 失败后重试中**~~|~~不可用~~|~~黑色~~|~~黑色~~|~~生成中~~|~~同状态3，生成中~~|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=YjBmMTgyYWExZGRlYmFmNzI2Zjc5MDMyOTU3MGMwNDFfd3B6SlpJN1ZpUzlBdzQ5cWxsblNLNzNmd3pyN1ZtVzNfVG9rZW46QUVOQ2JlWWVKb1JDTUJ4VWRSdWNOT3ZUbmxkXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|**7.用户点击下载**|点击方框后出现打勾|黑色|黑色|下载中|**系统逻辑：** 最多勾选4个课节进行下载|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=ODgwNTRkYmZmZTM4YTE2OTE1MGMxOGYyMTgxZjM4NmVfUWxCa3BmdHYzMkJIUXNiVmd6cDVuOWNGQ0ZQN1R1TjBfVG9rZW46Q29OWWJKYXBKb3hqVUx4YkZZWGN2YWowbnBoXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|

  

# 4.功能模块二：“小灶课”页面聊天记录导出

## 4.1 功能与交互状态概述

在辅导老师后台的“小班会”（小灶课）页面中，为已结束的课程提供聊天记录导出功能。

- **入口位置：** 辅导老师后台的“小班会”页面。
    
- **交互界面：** 在操作列，在“参课详情”链接旁添加”导出发言“文字链接和提示文案。
    
    - ”导出发言“链接状态说明
        
    
      1.可用：显示**蓝色**
    
      2.不可用（点击没反应）：显示灰色
    
      3.生成失败：**红色**
    
    - 提示文案提：
        
            **1.颜色：全程灰色**
        
            2.位置：”导出发言“下方
        

## 4.2. 场景汇总

|   |   |   |   |
|---|---|---|---|
|场景|链接状态|提示文案|交互说明|
|~~**1.小灶课未开始**~~|~~不显示~~|~~未开课~~|~~链接置灰不可操作~~<br><br>![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDQ3ZTI1MmFlMWUzMzA1OWE4OTliMThhMzQwOGMxOGRfa3lNeVVYRGtyVHNNb3NQaXNXdUhpV2owWEY1MkhCNGdfVG9rZW46SWVyd2J3OU55b3FubkZ4R0l4QWNDaFU5bjJkXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**2.小灶课课进行中**~~|~~不显示~~|~~**上课中**~~|~~**系统逻辑：**~~ ~~课程开始后，为保证数据完整性，链接置灰不可操作。~~<br><br>![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTQ1Y2Q1ZTA0ZDViMDRmMjY3NzU3OGU1ZTQxN2UyOGJfbThJWUo4WG5EY2U5R2t2MldwaklSdWRRNDR3T2htTXhfVG9rZW46RXVxcWJpREhzbzV1bWN4akVOMGNuNjNobjBlXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|0.下课之前|不显示|不显示|在下课之前不显示|
|**3.课刚结束，手动点击”导出记录“**|可用|**生成中**<br><br>1. **触发条件**：课程结束后（可能需要等待回放数据生成，大约课后半小时），辅导老师在后台页面可以看到可操作的按钮。<br>    <br>2. **用户操作**：辅导老师找到对应的课节，点击“导出发言”按钮。<br>    <br>3. **系统处理**：系统接收到请求后，开始**异步**处理生成聊天记录文件。此时前端界面会显示“生成中”的状态，并且按钮会被锁定，防止用户重复点击。|![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=MzExODg2MmFjNmRiN2VlMjk1NTllMTY2MjA2NjVmMWVfemR4dkxZOFlPSUFqektDUDBYMzB4SUFYUGI0Q0pVeUxfVG9rZW46RzB2UWJnUm9Ib3dEekl4WmJjYWNoNE5tblpkXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**4.发言记录生成成功**~~|~~可用~~|~~**生成成功**~~|~~点击”导出发言“后直接下载对应的Excel文件。~~<br><br>![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDczZTk0YjIxMGMyZmMzZmY3NWQxNzE0ZmMxMWM2NWRfQXF2eHQ4dXZId05JS2Iwd1QxOVMyQXNtUTNjRU4zWUNfVG9rZW46VmZ0dWJVeFFpbzUwOTl4SkNjTWM5SWpmbk1kXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**5.发言记录生成失败**~~|~~**生成失败**~~|~~**生成失败，请重新点击**~~|~~点击”导出发言“后重新触发生成任务。~~<br><br>![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=MjhjMThlMjQ0MDcxMzEwY2E2NzQ1MGEwODI0ZDQ1YzRfaVRRTUtEeU1KZjFodWZYcHhrUGdsUEI3T1ZlTVJSSk1fVG9rZW46TWhkZ2J1ZlpEb3BRbUx4UVBsMGNnRjhrbnBnXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|
|~~**6.生成失败后点击”导出发言“链接后**~~|~~不可用~~|~~**生成中**~~|~~同状态3生成中~~<br><br>![](https://qx9xydukti.feishu.cn/space/api/box/stream/download/asynccode/?code=YzA0ZmQ4NWZjOWJjMTRjMWVmNDI4N2E3ZTBhNDc0MDFfME1FQjFyWXBibDJtbzdObnAwS3NFaUNReWh2Szh1N1FfVG9rZW46SjNpR2I3WHRob3poMFF4bmNLVmM1OXRWbkkxXzE3NjQ0OTY3NjI6MTc2NDUwMDM2Ml9WNA)|

# **5. 导出文件规范**

- **文件格式：** Excel (`.xlsx`)
    
- **文件命名规范：** `[上课日期]-[时段课节名称/``小灶课直播名称``]-直播间聊天记录.xlsx`
    
    - _示例：20250904-18.【语文】欲扬先抑神转折-聊天记录.xlsx_
        
- **核心目的：** 提供该课节未经删减、最原始的完整聊天数据，用于沟通和追溯。
    
- **数据结构：** 表格严格遵循“一行一记录聊天发言”，并按发言时间顺序（从先到后）排列。
    
- **数据表头字段**:
    

|   |   |   |   |
|---|---|---|---|
|表头字段|字段说明与要求|备注|样例|
|**班组ID**|**(新增)**学生所在的辅导老师班组ID，用于老师快速定位。|会议重点补充字段|**1班-**312084582|
|用户ID|学生的唯一系统ID。|用于系统内部关联|9898xxxxxx|
|用户身份|发言者身份，如：学生、主讲老师、辅导老师等。|方便老师筛选特定身份发言|学生|
|用户昵称|学生/老师的姓名或昵称。||张三|
|发言时间|消息发送的精确时间，格式：`HH:MM:SS`。||19:35:22|
|发言内容|用户发送的完整聊天文字内容。需过滤掉无法解析为文本的表情包。|核心数据，需保证完整性|老师，我想要报名！|
|**发言类型**|**(新增)** 标识该条发言是公开发言还是私聊发言。|**可选值：公聊、私聊**|**公聊**|
|**内容类型**|**(新增)** 标识发言内容的具体格式，便于筛选和分析。|**可选值建议：文本、互动表情**|**文本**|
|私聊接收方用户id|**（新增)** 用户的唯一身份标识，用于指定私聊消息的接收方。|此字段仅在“发言类型”为“私聊”时为必填项，公聊时应为空。|89487174|

# **6. 技术实现要点**

- **数据导出为异步任务**：前端发起请求后，后端加入任务队列处理，处理完成后更新状态。前端通过轮询或回调获取最新状态。
    
- **请求参数**：前端发起生成请求时，需携带辅导老师ID、直播间ID、组ID等关键信息，以便后端精准定位数据范围。
    
- **前端加锁**：在“生成中”或用户点击下载后，前端需锁定对应操作按钮，防止因用户重复点击导致系统负载过高或产生重复任务。
    

# **7. 运营与上线计划**

**关于“小灶课”导出功能：若老师提前下课，系统将在课程预设的结束时间到达后，才开放导出权限。**

[直播间聊天记录导出功能 - 操作指南](https://qx9xydukti.feishu.cn/wiki/XPfdwPpa6i1Tgrk8SiZcuunBnYe?from=from_copylink)

# **8. 附录**

无